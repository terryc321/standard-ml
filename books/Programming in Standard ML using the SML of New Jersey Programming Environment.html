
<!-- saved from url=(0056)https://www.itu.dk/~carsten/courses/s03/handouts/ml.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Programming in Standard ML using the SML of New Jersey Programming Environment</title>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#000080" vlink="#6666CC" alink="#800000">



<h2>Programming in Standard ML using the SML of New Jersey Programming Environment</h2>

<p>
The programming environment we will be using for the course will be the Standard
ML of New Jersey system (or SML/NJ).  This guide provides instructions for how
to set up your zoo account to use SML/NJ.  
This is not intended as a guide to programming in Standard
ML; for that purpose you are referred to the <a href="https://www.itu.dk/~carsten/courses/s03/handouts/intro-sml.pdf">course textbook</a>.

</p><p>
You can find a Windows version of SML at: <a href="http://cm.bell-labs.com/cm/cs/what/smlnj/install/index.html">SML/NJ Download</a>.
</p><p>
</p><h2>Installation</h2>

<p>
The most convenient way to run SML/NJ is using the SML mode for
Emacs-19 (or later).  To set up your Emacs to use this mode, add the
following lines to the end of your <tt>.emacs</tt> file:

</p><pre>(setq load-path (cons "/c/cs201/lib/elisp" load-path))
(autoload 'sml-mode  "sml-mode" "Major mode for editing SML." t)
(setq auto-mode-alist
      (cons '("\.sml$" . sml-mode)
            (cons '("\.sig$" . sml-mode)
		  (cons '("\\.fun$"  . sml-mode)
                  auto-mode-alist))))
(load-library "sml-font")
(defun turn-on-font-lock () (font-lock-mode t))
</pre>

<p>
These lines can also be found in the file <tt>lib/elisp/emacs.additions</tt> in the
course directory.

</p><p>
Note that the SML mode works only for Emacs versions 19 and later.


</p><h2>Starting SML/NJ</h2>

<p>
With your <tt>.emacs</tt> file set up as above, you may enter the SML mode
either by loading any file with a <tt>.sml</tt> or <tt>.sig</tt> extension, or
by typing <tt>M-x sml-mode</tt>.  The SML mode provides indentation and other
facility that may be helpful in editing SML source code.

</p><p>
Once in the SML mode, you can start SML/NJ by typing <tt>M-x sml</tt>, or by
selecting <em>SML/Process/Start default ML compiler</em> from the menu.  This
will start SML/NJ running in the background.  You can then bring up an SML/NJ
window by typing <tt>C-c C-s</tt>, or by selecting <em>SML/Process/switch to ML
buffer</em> from the menu.  On some machines SML/NJ may be slow to load; if the
window comes up empty, be patient.

</p><p>
If you prefer not to run SML/NJ through Emacs, you may also run it from the Unix
prompt  <tt>sml</tt>.

</p><h2>Interacting with SML/NJ</h2>

<p>
Once SML/NJ has started, it prints the current version number and then prompts
for user input.  The prompt is a single dash.  At the prompt you may type an SML
top-level declaration or an SML expression.  When you enter a declaration,
SML/NJ evaluates the declaration, prints its result value and type, and prompts
for more input.  For example (user input in <b>bold</b>):

</p><pre>- <b>val a = 2 + 3;</b>
val a = 5 : int
- 
</pre>

<p>
This declaration sets <tt>a</tt> equal to the value of <tt>2 + 3</tt>,
that is, 5. The semicolon at the end of the input line tells the SML
parser that its input is complete. By leaving off the semicolon you
may enter multi-line declarations or expressions. Each line after the
first is prompted by an equals. For example, we may declare a two-line
increment function by:

</p><pre>- <b>fun inc x =</b>
= <b>x + 1;</b>
val inc = fn : int -&gt; int
- 
</pre>

<p>
In each of the above examples, the identifier being declared (<tt>a</tt> or
<tt>inc</tt>) is available in code that follows.  When you enter an expression
at the user prompt, SML/NJ treats that expression as a declaration for the
identifier <tt>it</tt>.  For example:

</p><pre>- <b>inc a;</b>
val it = 6 : int
- <b>it * 3;</b>
val it = 18 : int
- 
</pre>

<h3>Using files</h3>

<p>
The interactive loop, as the above is called, is a convenient way to evaluate
small expressions and declarations, but it is not practical for larger pieces of
code.  For larger pieces of code we want to load them directly into SML/NJ from
a file.  This is done by running the <tt>use</tt> command.  SML/NJ will then
process the file as if it had been entered into the interactive loop (except
that no semicolon is needed at the end of the file).  For example, suppose the
file <tt>myprog.sml</tt> contained the code:

</p><pre>val b = 3 + 4
val c = 6 * b
</pre>

<p>
Then using that file will cause SML/NJ to respond:

</p><pre>- <b>use "myprog.sml";</b>
[opening myprog.sml]
val b = 7 : int
val c = 42 : int
val it = () : unit
-
</pre>

<p>
The final binding to <tt>it</tt> happens because SML/NJ views <tt>use
"myprog.sml"</tt> as an expression and, as discussed above, treats that expression
as a declaration for the identifier <tt>it</tt>.  The value of this expression is
<tt>()</tt>, which is pronounced ``unit.''

</p><h3>Idiosyncrasies</h3>

<p>
When SML/NJ prints a data structure, it prints that data structure only to a
certain depth.  Beneath that depth it prints a <tt>#</tt> instead.  This is
generally a good thing, since data structures can be very large (and even
cyclic).  However, the default depth to which SML/NJ prints data structures is
5, which is usually not enough.  You can adjust the depth to which it prints
data structures by entering, for example,

</p><pre>- <b>Compiler.Control.Print.printDepth := 10;</b>
</pre>

<p>
to set the depth to 10.  SML/NJ also abbreviates list and strings over a certain
length.  You can set the length at which this happens by setting
<tt>Compiler.Control.Print.printLength</tt> and
<tt>Compiler.Control.Print.stringDepth</tt>, in a manner analogous to the
above.

</p><p>
When the argument to <tt>use</tt> is not a full path name, SML/NJ looks for source
files in the working directory.  You can set SML/NJ's working directory by
entering, for example,

</p><pre>- <b>OS.FileSys.chDir "newdir";</b>
</pre>

<p>
to change the working directory to ``newdir.''  Windows users should note that
the SML syntax for strings doubles backslashes.  You can also find out what the
working directory is with the command:

</p><pre>- <b>OS.FileSys.getDir ();</b>
</pre>

<h2>Using the SML mode for Emacs</h2>

<p>
When running SML under Emacs, you can have Emacs issue <tt>use</tt> commands to
SML/NJ instead of entering them yourselves.  The command <tt>C-c C-b</tt> sends the
current buffer to SML/NJ and <tt>C-c C-r</tt> sends the current Emacs region.  You
can also have Emacs issue directory change commands with <tt>M-x sml-cd</tt>.

</p><p>
One of the most useful things Emacs can do for you is to parse error messages
and locate their source.  After compiling a file, enter <tt>C-c `</tt> and Emacs
will locate and highlight your first error, as reported by SML/NJ.  You may then
locate successive errors by repeating the command.  Note that if you enter a
<tt>use</tt> command directly into SML/NJ, Emacs will not know of it, and will
continue parsing errors from the previous compile.  You can get Emacs back into
synch by directing it to ignore all remaining error using the <tt>M-x
sml-skip-errors</tt> command.

</p><p>
You may also wish to experiment with the <tt>M-|</tt> command, which begins a new
branch of a case statement or function definition.

</p><p>
A summary of these commands appears below:
</p>

<table border="">
<tbody><tr>
<td>key sequence</td> <td>command name</td>
</tr>
<tr>
<td><tt>C-c C-b</tt></td> <td><tt>sml-send-buffer</tt></td>
</tr>
<tr>
<td><tt>C-c C-r</tt></td> <td><tt>sml-send-region</tt></td>
</tr>
<tr>
<td><tt>M-x sml-cd</tt></td> <td><tt>sml-cd</tt></td>
</tr>
<tr>
<td><tt>C-c `</tt></td> <td><tt>sml-next-error</tt></td>
</tr>
<tr>
<td><tt>M-x sml-skip-errors</tt></td> <td><tt>sml-skip-errors</tt></td>
</tr>
<tr>
<td><tt>M-|</tt></td> <td><tt>sml-electric-pipe</tt></td>
</tr>
</tbody></table>

<h2>Some Useful SML links</h2>

<ul><li><a href="http://cm.bell-labs.com/cm/cs/what/smlnj/doc/errors.html">http://cm.bell-labs.com/cm/cs/what/smlnj/doc/errors.html</a>: SML/NJ error messages explained
</li><li><a href="http://cm.bell-labs.com/cm/cs/what/smlnj/doc/basis/pages/sml-std-basis.html">http://cm.bell-labs.com/cm/cs/what/smlnj/doc/basis/pages/sml-std-basis.html</a>: SML Basis Library documentation
</li></ul>




</body></html>